<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
  <title>Scramjet</title>

  <!-- keep your external assets so existing search + client logic works -->
  <link rel="shortcut icon" href="favicon.webp" />
  <link rel="stylesheet" href="index.css" />
  <script src="/scram/scramjet.all.js"></script>
  <script src="baremux/index.js" defer></script>
  <script src="epoxy/index.js" defer></script>
  <script src="register-sw.js" defer></script>
  <script src="search.js" defer></script>
  <script src="index.js" defer></script>

  <!-- lightweight house styling; safe with your existing CSS -->
  <style>
    :root {
      --bg: #000;
      --panel: #0b0b0b;
      --text: #f2f2f2;
      --muted: #b5b5b5;
      --accent: #ffffff;
      --glow: 0 0 18px rgba(255,255,255,0.12), 0 0 4px rgba(255,255,255,0.18);
      --radius: 18px;
      --inset: inset 0 0 0 1px rgba(255,255,255,0.18);
    }
    html, body { height: 100%; }
    body {
      margin: 0; background: var(--bg); color: var(--text);
      font-family: "Courier New", Courier, monospace; letter-spacing: 0.2px;
      display: grid; place-items: center; padding: 28px;
    }

    .wrap { width: min(920px, 100%); }

    .brand { display: flex; align-items: center; gap: 12px; margin-bottom: 18px; }
    .brand h1 { margin: 0; font-size: clamp(24px, 5vw, 40px); font-weight: 700; text-shadow: 0 0 12px rgba(255,255,255,0.1); }
    .brand img.logo { width: 40px; height: 40px; image-rendering: pixelated; border-radius: 8px; }
    .tag { color: var(--muted); font-size: 12px; opacity: .9; }

    .card {
      background: var(--panel);
      border: 1px solid rgba(255,255,255,0.18);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: var(--glow), var(--inset);
    }

    .row { display: grid; grid-template-columns: 1fr auto; gap: 10px; }

    /* keep IDs that search.js expects */
    #sj-address {
      width: 100%; height: 52px; padding: 0 16px; border-radius: 14px;
      background: #0f0f0f; color: var(--text);
      border: 1px solid rgba(255,255,255,0.25);
      box-shadow: var(--inset);
      outline: none;
    }

    .btn {
      height: 52px; padding: 0 18px; border-radius: 14px; cursor: pointer;
      border: 1px solid #fff; color: #000; background: #fff; font-weight: 700;
      transition: transform .06s ease;
    }
    .btn:hover { transform: translateY(-1px); }
    .btn:active { transform: translateY(0); }

    .desc { color: var(--muted); font-size: 14px; margin-top: 10px; }

    .quick { margin-top: 14px; display: flex; flex-wrap: wrap; gap: 8px; }
    .chip { border: 1px dashed rgba(255,255,255,0.35); color: var(--text);
      padding: 8px 10px; border-radius: 999px; cursor: pointer; font-size: 12px; opacity: .9; background: transparent; }
    .chip:hover { border-style: solid; }

    details { margin-top: 16px; border-radius: 12px; background: #0b0b0b; border: 1px solid rgba(255,255,255,0.18); box-shadow: var(--inset); }
    summary { cursor: pointer; padding: 12px 14px; color: var(--muted); }
    .cfg { padding: 0 14px 14px; display: grid; gap: 10px; }
    .cfg label { font-size: 12px; color: var(--muted); display:block; margin-bottom: 6px; }
    .cfg .g { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }

    .footer { margin-top: 16px; color: var(--muted); font-size: 12px; text-align: center; opacity: .8; }

    @media (max-width: 640px) { .row { grid-template-columns: 1fr; } .btn { width: 100%; } .cfg .g { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <main class="wrap">
    <!-- header/brand -->
    <div class="brand">
      <img class="logo" src="sj.png" alt="Scramjet" />
      <div>
        <h1>Scramjet | MW</h1>
        <div class="tag">experimental interception-based web proxy</div>
      </div>
    </div>

    <!-- lead copy -->
    <section class="desc">
      <p>
        Scramjet is an experimental interception-based web proxy designed to evade internet censorship,
        bypass arbitrary web browser restrictions, and innovate web proxy technologies.
      </p>
    </section>

    <!-- main card: KEEP the exact IDs that power search.js  -->
    <section class="card">
      <form id="sj-form" class="row" autocomplete="off">
        <input id="sj-search-engine" value="https://www.google.com/search?q=%s" type="hidden" />
        <input id="sj-address" type="text" placeholder="Search the web freely" />
        <button id="go" class="btn" type="submit" title="Launch">GO</button>
      </form>

      <div class="quick" id="quick"></div>

      <div class="desc">
        <p id="sj-error"></p>
        <pre id="sj-error-code"></pre>
      </div>

      <details>
        <summary>Advanced (transport & paths)</summary>
        <div class="cfg">
          <div class="g">
            <div>
              <label for="cfg-entry">Scramjet client entry (path that accepts ?url=)</label>
              <input id="cfg-entry" class="input" type="text" placeholder="/client/" />
            </div>
            <div>
              <label for="cfg-bare">Bare‑Mux static path (served by your server)</label>
              <input id="cfg-bare" class="input" type="text" placeholder="/baremux/" />
            </div>
          </div>
          <div class="g">
            <div>
              <label for="cfg-wisp">WISP / Transport endpoint (optional)</label>
              <input id="cfg-wisp" class="input" type="text" placeholder="wss://your-wisp.example/ws" />
            </div>
            <div>
              <label for="cfg-blank">Open in about:blank shell (toggle per‑launch)</label>
              <select id="cfg-blank" class="input">
                <option value="off">Off (default)</option>
                <option value="on">On</option>
              </select>
            </div>
          </div>
          <div class="g">
            <button id="cfg-save" class="btn" style="border-color:#fff;background:#000;color:#fff" type="button">Save Config</button>
            <button id="cfg-reset" class="btn" style="border-color:#fff;background:#000;color:#fff" type="button">Reset</button>
          </div>
        </div>
      </details>
    </section>

    <!-- footer links (kept from your original) -->
    <footer class="footer">
      <div style="display:flex; gap:14px; justify-content:center; flex-wrap:wrap;">
        <a title="The Mercury Workshop GitHub organization" href="https://github.com/MercuryWorkshop">Mercury Workshop</a>
        <a title="The example demo app for Scramjet" href="https://github.com/MercuryWorkshop/Scramjet-Demo">GitHub</a>
        <a title="License information" href="credits.html">Credits</a>
      </div>
      <div style="margin-top:6px;">Scramjet &copy; MW 2025</div>
    </footer>

    <!-- hidden iframe kept for your search/index.js logic -->
    <iframe style="display: none" id="sj-frame"></iframe>
  </main>

  <script>
    // ——— Enhance without breaking your existing search.js/index.js ———
    // We keep IDs the same so your current search handler keeps working.
    // Below adds: quick links + a tiny config that persists and augments query building.

    const LS_KEY = "scramjet_home_cfg_v1";
    const CONFIG = Object.assign({
      entry: "/client/",
      barePath: "/baremux/",
      wisp: "",
      aboutBlank: "off",
    }, JSON.parse(localStorage.getItem(LS_KEY) || "null") || {});

    // Paint advanced fields
    const $ = (s)=>document.querySelector(s);
    const entry = $("#cfg-entry");
    const bare = $("#cfg-bare");
    const wisp = $("#cfg-wisp");
    const blank = $("#cfg-blank");
    function paintCfg(){ if(entry) entry.value = CONFIG.entry; if(bare) bare.value = CONFIG.barePath; if(wisp) wisp.value = CONFIG.wisp; if(blank) blank.value = CONFIG.aboutBlank; }
    paintCfg();

    $("#cfg-save")?.addEventListener("click", ()=>{
      CONFIG.entry = (entry?.value || "/client/").trim();
      CONFIG.barePath = (bare?.value || "/baremux/").trim();
      CONFIG.wisp = (wisp?.value || "").trim();
      CONFIG.aboutBlank = (blank?.value || "off");
      localStorage.setItem(LS_KEY, JSON.stringify(CONFIG));
    });
    $("#cfg-reset")?.addEventListener("click", ()=>{ localStorage.removeItem(LS_KEY); location.reload(); });

    // Quick links (click to auto-fill and submit)
    const QUICK_LINKS = ["https://google.com","https://youtube.com","https://tiktok.com","https://github.com"]; 
    const quick = $("#quick");
    const form = $("#sj-form");
    const addr = $("#sj-address");
    if (quick && form && addr) {
      QUICK_LINKS.forEach(u=>{
        const b = document.createElement("button");
        b.type = "button"; b.className = "chip"; b.textContent = new URL(u).hostname.replace("www.", "");
        b.addEventListener("click", ()=>{ addr.value = u; form.requestSubmit(); });
        quick.appendChild(b);
      });
    }

    // Gentle augmentation: if we have config, append as search params only when your client supports them.
    // We do it by intercepting submit, then letting the existing handler continue with a modified value.
    if (form && addr) {
      form.addEventListener("submit", (e)=>{
        // If the address already includes params, don't double-append; otherwise add hints your client may read.
        try {
          const url = new URL(addr.value, location.origin);
          // Only append if going to your client entry path (heuristic):
          if (CONFIG.entry && url.pathname.startsWith(CONFIG.entry)) {
            const sp = url.searchParams;
            if (CONFIG.barePath && !sp.has("bare")) sp.set("bare", CONFIG.barePath);
            if (CONFIG.wisp && !sp.has("wisp")) sp.set("wisp", CONFIG.wisp);
            addr.value = url.pathname + "?" + sp.toString();
          }
        } catch(_) { /* let your existing code resolve/handle raw searches */ }
      }, { capture: true });
    }

    // Optional: about:blank shell. If "on", open a blank tab and let your existing logic load into it.
    if (form && addr) {
      form.addEventListener("submit", (e)=>{
        if (CONFIG.aboutBlank === "on") {
          const win = window.open("about:blank", "_blank");
          if (win && win.document) {
            // Give your existing handlers a chance to compute the final target by posting intent.
            // Fallback: navigate current tab if blocked.
            setTimeout(()=>{ if (!win.closed) win.focus(); }, 50);
          }
        }
      });
    }
  </script>
</body>
</html>
