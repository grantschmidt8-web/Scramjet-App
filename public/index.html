<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>PROJECT TRINITY</title>
    <link rel="shortcut icon" content="favicon.webp" />

    <style>
      :root { --fg:#fff; --bg:#000; }
      html,body { height:100%; }
      body {
        margin:0;
        background:var(--bg);
        color:var(--fg);
        font:16px/1.5 "Courier New", ui-monospace, monospace;
      }

      .wrap {
        max-width:780px;
        margin:14vh auto 12vh;
        padding:0 18px;
      }

      .title { margin:0 0 10px; font-size:34px; font-weight:700; }
      .subtitle { margin:0 0 18px; color:#ddd; font-size:13px; }

      /* Search form (keep Scramjet IDs) */
      .bar {
        display:flex; align-items:center;
        border:1px solid #fff; border-radius:4px;
        padding:12px 14px; margin:0;
      }
      #sj-address{
        all:unset;
        color:#fff; width:100%;
        font:16px/1.4 "Courier New", ui-monospace, monospace;
      }
      #sj-address::placeholder{ color:#bfbfbf; }
      .bar:focus-within{ outline:2px solid #fff; outline-offset:2px; }

      .links{
        display:flex; flex-wrap:wrap; gap:10px; align-items:center;
        margin-top:16px; font-size:13px;
      }
      .links a{ color:#fff; text-decoration:none; border-bottom:1px solid transparent; }
      .links a:hover{ border-bottom-color:#fff; }

      /* Keep hooks but hide error UI */
      #sj-error, #sj-error-code { display:none; }

      /* Allow JS to show the iframe */
      #sj-frame{
        display:none;              /* JS will set display:block */
        border:none;
        position:fixed; inset:0;
        width:100vw; height:100vh;
        background:#000;
        z-index: 9999;             /* ensure it covers the homepage when shown */
      }

      @media (max-width:640px){
        .wrap{ margin:11vh auto 9vh; }
        .title{ font-size:28px; }
        .bar{ padding:14px 16px; }
        #sj-address{ font-size:16px; }
      }
    </style>

    <!-- Transport/runtime & your scripts (order matters) -->
    <!-- If your app serves these at /scram, /baremux, /epoxy, keep leading slashes. -->
    <script src="/scram/scramjet.all.js"></script>
    <script src="/baremux/index.js" defer></script>
    <script src="/epoxy/index.js" defer></script>

    <!-- Optional: Wisp client (harmless if unused, useful if your build uses Wisp) -->
    <script src="https://unpkg.com/wisp-js/dist/wisp.min.js" defer></script>

    <script src="register-sw.js" defer></script>
    <script src="search.js" defer></script>
    <script src="index.js" defer></script>

    <!-- Tiny safety shim: set WISP_URL default + force HTTPS inputs BEFORE your handlers run -->
    <script>
      // 1) Default WISP_URL if config.js (or your code) didn't set it
      (function(){
        // Only set if not already defined and we're under HTTPS
        if (!('WISP_URL' in window) && location.protocol === 'https:') {
          window.WISP_URL = 'wss://' + location.host + '/wisp/';
        }
      })();

      // 2) Normalize input to https/search before your existing submit handler runs
      // Use capture=true so this fires before bubble-phase listeners in search.js
      window.addEventListener('DOMContentLoaded', function(){
        var form = document.getElementById('sj-form');
        var addr = document.getElementById('sj-address');
        if (!form || !addr) return;

        function normalizeInput(q) {
          q = (q || '').trim();
          // bare word → search
          if (!/^[a-z][a-z0-9+.-]*:\/\//i.test(q) && !q.includes('.')) {
            return 'https://www.google.com/search?q=' + encodeURIComponent(q);
          }
          // missing scheme → https
          if (!/^[a-z][a-z0-9+.-]*:\/\//i.test(q) && q.includes('.')) {
            return 'https://' + q;
          }
          // force https for http URLs
          return q.replace(/^http:\/\//i, 'https://');
        }

        form.addEventListener('submit', function(){
          addr.value = normalizeInput(addr.value);
        }, true); // capture
      });
    </script>
  </head>

  <body>
    <main class="wrap">
      <h2 class="title">PROJECT TRINITY</h2>

      <!-- IDs must match Scramjet scripts -->
      <form id="sj-form" class="bar" autocomplete="off">
        <input id="sj-search-engine" type="hidden" value="https://www.google.com/search?q=%s" />
        <input id="sj-address" type="text" placeholder="URL or search…" spellcheck="false" inputmode="url" />
      </form>

      <!-- Hooks exist but hidden -->
      <p id="sj-error"></p>
      <pre id="sj-error-code"></pre>

      <nav class="links">
        <a href="https://scramjet-app-50ls.onrender.com/scramjet/https%3A%2F%2Fwww.youtube.com%2Fl">Youtube</a>
        <span>·</span>
        <a href="https://scramjet-app-50ls.onrender.com/scramjet/https%3A%2F%2Fplay.geforcenow.com%2Fmall%2F" target="_blank" rel="noopener">Geforce Now</a>
        <span>·</span>
        <a href="https://www.trinity.gt.tc" target="_blank" rel="noopener">TRINITY</a>
        <span>·</span>
        <span>PT © 2025</span>
      </nav>
    </main>

    <!-- Scramjet's rendering surface -->
    <iframe id="sj-frame"></iframe>
  </body>
</html>
