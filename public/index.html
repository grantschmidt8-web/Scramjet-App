<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scramjet</title>

  <!-- Make sure this file exists; otherwise remove this line -->
  <link rel="icon" href="favicon.webp" />

  <!-- Minimal inline styles so it renders even if index.css 404s -->
  <style>
    :root { --bg:#000; --panel:#0b0b0b; --text:#f2f2f2; --muted:#b5b5b5; --radius:18px;
            --glow:0 0 18px rgba(255,255,255,.12),0 0 4px rgba(255,255,255,.18);
            --inset:inset 0 0 0 1px rgba(255,255,255,.18);}
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--text);font-family:"Courier New",monospace;
         display:grid;place-items:center;padding:28px}
    .wrap{width:min(920px,100%)} .brand{display:flex;align-items:center;gap:12px;margin-bottom:18px}
    .brand h1{margin:0;font-size:clamp(24px,5vw,40px)} .logo{width:40px;height:40px;image-rendering:pixelated;border-radius:8px}
    .tag{color:var(--muted);font-size:12px;opacity:.9}
    .card{background:var(--panel);border:1px solid rgba(255,255,255,.18);border-radius:18px;padding:18px;box-shadow:var(--glow),var(--inset)}
    .row{display:grid;grid-template-columns:1fr auto;gap:10px}
    #sj-address{height:52px;padding:0 16px;border-radius:14px;background:#0f0f0f;color:var(--text);
                border:1px solid rgba(255,255,255,.25);box-shadow:var(--inset);outline:none}
    .btn{height:52px;padding:0 18px;border-radius:14px;border:1px solid #fff;background:#fff;color:#000;font-weight:700;cursor:pointer}
    .quick{margin-top:14px;display:flex;flex-wrap:wrap;gap:8px}
    .chip{border:1px dashed rgba(255,255,255,.35);color:var(--text);padding:8px 10px;border-radius:999px;cursor:pointer;font-size:12px;background:transparent}
    .desc{color:var(--muted);font-size:14px;margin-top:10px} .footer{margin-top:16px;color:var(--muted);font-size:12px;text-align:center;opacity:.8}
    details{margin-top:16px;border-radius:12px;background:#0b0b0b;border:1px solid rgba(255,255,255,.18);box-shadow:var(--inset)}
    summary{cursor:pointer;padding:12px 14px;color:var(--muted)} .cfg{padding:0 14px 14px;display:grid;gap:10px}
    .cfg .g{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media(max-width:640px){.row{grid-template-columns:1fr}.btn{width:100%}.cfg .g{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <main class="wrap">
    <header class="brand">
      <img class="logo" src="sj.png" alt="Scramjet" />
      <div>
        <h1>Scramjet</h1>
        <div class="tag">interception-based web proxy</div>
      </div>
    </header>

    <section class="card">
      <!-- IMPORTANT: these IDs are what your search/index scripts hook into -->
      <form id="sj-form" class="row" autocomplete="off">
        <input id="sj-search-engine" type="hidden" value="https://www.google.com/search?q=%s" />
        <input id="sj-address" type="text" placeholder="Search or enter a URL" />
        <button class="btn" type="submit">GO</button>
      </form>

      <div class="quick" id="quick"></div>

      <div class="desc">
        <p id="sj-error"></p>
        <pre id="sj-error-code"></pre>
      </div>

      <details>
        <summary>Advanced</summary>
        <div class="cfg">
          <div class="g">
            <label>Client entry (accepts ?url=)
              <input id="cfg-entry" class="input" placeholder="/client/" />
            </label>
            <label>Bare-Mux static path
              <input id="cfg-bare" class="input" placeholder="/baremux/" />
            </label>
          </div>
          <div class="g">
            <label>WISP / Transport endpoint
              <input id="cfg-wisp" class="input" placeholder="wss://your-wisp.example/ws" />
            </label>
            <label>about:blank shell
              <select id="cfg-blank" class="input">
                <option value="off">Off</option>
                <option value="on">On</option>
              </select>
            </label>
          </div>
          <div class="g">
            <button id="cfg-save" class="btn" type="button">Save</button>
            <button id="cfg-reset" class="btn" type="button">Reset</button>
          </div>
        </div>
      </details>
    </section>

    <footer class="footer">Scramjet Â© MW 2025</footer>

    <!-- kept for compatibility with some demo flows -->
    <iframe style="display:none" id="sj-frame"></iframe>
  </main>

  <!-- Load scripts LAST so DOM exists. Order matters. -->
  <script>
    // Hard defaults (override via Advanced panel). Change these if your routes differ.
    window.SJ_CONFIG = { entry:"/client/", barePath:"/baremux/", wisp:"", aboutBlank:"off" };
  </script>
  <script src="/scram/scramjet.all.js"></script>
  <script src="baremux/index.js"></script>
  <script src="epoxy/index.js"></script>
  <script src="register-sw.js"></script>

  <!-- Inline fallback so search works even if your external JS fails -->
  <script>
    (function(){
      const $ = (s)=>document.querySelector(s);
      const CFG = window.SJ_CONFIG || {};
      const form = $("#sj-form"), addr=$("#sj-address"), engineEl=$("#sj-search-engine");
      const err=$("#sj-error"), errCode=$("#sj-error-code");

      function isURL(q){ try{ new URL(q); return true; }catch(_){ return /^[^\s]+\.[^\s]{2,}$/.test(q); } }
      function norm(q){ q=(q||"").trim(); if(!q) return ""; try{ new URL(q); return q; }catch(_){}
        return /^[^\s]+\.[^\s]{2,}$/.test(q) ? "https://"+q : q; }
      function build(target){
        const base=(CFG.entry||"/client/").replace(/\/?$/, "/");
        const u=new URL(base, location.origin);
        u.searchParams.set("url", target);
        if (CFG.barePath) u.searchParams.set("bare", CFG.barePath);
        if (CFG.wisp) u.searchParams.set("wisp", CFG.wisp);
        return u.pathname + "?" + u.searchParams.toString();
      }

      form?.addEventListener("submit", (e)=>{
        e.preventDefault();
        err.textContent=""; errCode.textContent="";
        let q = addr.value || "";
        if (!q.trim()) return;

        if (!isURL(q)) {
          const fmt = (engineEl?.value || "https://www.google.com/search?q=%s");
          q = fmt.replace("%s", encodeURIComponent(q));
        }

        try { location.href = build(norm(q)); }
        catch (ex) { err.textContent = "Failed to build client URL."; errCode.textContent = String(ex?.stack || ex); }
      });

      // Advanced panel: save/restore
      const KEY="scram_cfg_v1", E=$("#cfg-entry"), B=$("#cfg-bare"), W=$("#cfg-wisp"), BL=$("#cfg-blank");
      try { const saved = JSON.parse(localStorage.getItem(KEY)||"null"); if (saved) Object.assign(CFG, saved); } catch(_){}
      function paint(){ if(E)E.value=CFG.entry||"/client/"; if(B)B.value=CFG.barePath||"/baremux/"; if(W)W.value=CFG.wisp||""; if(BL)BL.value=CFG.aboutBlank||"off"; }
      paint();
      $("#cfg-save")?.addEventListener("click", ()=>{ CFG.entry=E?.value||CFG.entry; CFG.barePath=B?.value||CFG.barePath; CFG.wisp=W?.value||CFG.wisp; CFG.aboutBlank=BL?.value||"off"; try{ localStorage.setItem(KEY, JSON.stringify(CFG)); }catch(_){}} );
      $("#cfg-reset")?.addEventListener("click", ()=>{ try{ localStorage.removeItem(KEY);}catch(_){ } location.reload(); });

      // Quick chips
      const quick=$("#quick"); const links=["https://google.com","https://youtube.com","https://tiktok.com","https://github.com"];
      if (quick && form && addr) links.forEach(u=>{ const b=document.createElement("button");
        b.type="button"; b.className="chip"; b.textContent=new URL(u).hostname.replace(/^www\./,"");
        b.onclick=()=>{ addr.value=u; form.requestSubmit(); }; quick.appendChild(b); });
    })();
  </script>
</body>
</html>
