<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PROJECT TRINITY</title>
<link rel="shortcut icon" content="favicon.webp" />

<style>
  :root{
    /* Fixed DARK theme tokens (light removed) */
    --fg:#e6e6e6; --fg-dim:#bdbdbd; --bg:#0a0a0a;
    --grad-1:#0a0a0a; --grad-2:#0d0d0d; --grad-3:#121212;
    --stroke:#262626; --accent:#8a8a8a; --chrome-h:96px; --radius:14px; --tab-h:34px;
    --shadow:0 10px 26px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.03);
  }
  *{ box-sizing:border-box } html,body{ height:100% }
  body{
    margin:0; color:var(--fg);
    font:14px/1.45 system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans";
    background:
      radial-gradient(1100px 520px at 80% -10%, rgba(140,140,140,.10) 0%, rgba(0,0,0,0) 60%),
      radial-gradient(900px 480px at -10% 110%, rgba(160,160,160,.08) 0%, rgba(0,0,0,0) 60%),
      linear-gradient(180deg, var(--grad-1) 0%, var(--grad-2) 55%, var(--grad-3) 100%);
  }

  /* ===== Header (collapsible) ===== */
  .chrome{
    position:fixed; inset:0 0 auto 0; z-index:10000;
    backdrop-filter:saturate(120%) blur(10px);
    background:linear-gradient(180deg, rgba(18,18,18,.82), rgba(12,12,12,.68));
    border-bottom:1px solid var(--stroke);
    box-shadow:var(--shadow);
    transform:translateY(0); transition:transform .18s ease;
  }
  html[data-collapsed="1"] .chrome{ transform:translateY(-110%); pointer-events:none; }
  .row{ display:flex; align-items:center; gap:10px; padding:10px 12px; }
  .row.tabs{ padding:8px 12px 0; border-bottom:1px solid var(--stroke); align-items:flex-end; overflow:hidden; }

  .tabs-wrap{
    flex:1 1 auto; display:flex; align-items:flex-end; gap:8px;
    overflow-x:auto; padding:0 6px; scrollbar-width:none; -ms-overflow-style:none;
  }
  .tabs-wrap::-webkit-scrollbar{ display:none }

  .tab, .tab-add{
    height:var(--tab-h);
    position:relative; display:flex; align-items:center; gap:8px;
    max-width:260px; white-space:nowrap; cursor:pointer; user-select:none;
    padding:0 12px; border:1px solid var(--stroke); border-bottom-color:transparent;
    border-radius:18px 18px 0 0;
    background:linear-gradient(180deg, rgba(28,28,28,.92), rgba(18,18,18,.88));
    color:var(--fg);
    box-shadow:0 6px 18px rgba(0,0,0,.45), inset 0 1px 0 rgba(255,255,255,.03);
    margin-bottom:-1px; z-index:1;
    transition:box-shadow .12s ease, border-color .12s ease, background .12s ease;
  }
  .tab:hover, .tab-add:hover{ box-shadow:0 10px 26px rgba(0,0,0,.55), inset 0 1px 0 rgba(255,255,255,.04); }
  .tab.active{
    border-color:var(--accent); border-bottom-color:#0000;
    background:linear-gradient(180deg, rgba(32,32,32,.96), rgba(20,20,20,.92));
    box-shadow:0 14px 34px rgba(0,0,0,.6), 0 0 0 1px rgba(255,255,255,.04) inset; z-index:2;
  }
  .tab .fav{ width:16px; height:16px; border-radius:4px; object-fit:cover; flex:0 0 16px; background:#1a1a1a; border:1px solid #2a2a2a; }
  .tab .label{ overflow:hidden; text-overflow:ellipsis; color:var(--fg) }
  .tab .close{ display:inline-flex; align-items:center; justify-content:center; width:20px; height:20px; border-radius:7px; color:var(--fg-dim); }

  .tab-add{ flex:0 0 auto; max-width:none; gap:6px; font-weight:700; letter-spacing:.4px; }
  .tab-add::before{ content:"+"; display:inline-block; line-height:1; font-size:16px; color:var(--fg); transform: translateY(-1px); }

  .omnibox{ flex:1 1 auto; display:flex; align-items:center; gap:10px; padding:6px 12px; min-width:0; }
  .btn{
    border:1px solid var(--stroke);
    background:linear-gradient(180deg, rgba(26,26,26,.95), rgba(18,18,18,.9));
    color:var(--fg); border-radius:10px; height:34px; min-width:34px; padding:0 10px;
    cursor:pointer; display:inline-flex; align-items:center; justify-content:center;
    box-shadow:inset 0 1px 0 rgba(255,255,255,.03), 0 6px 18px rgba(0,0,0,.45);
  }
  .btn.icon{ width:34px; min-width:34px; padding:0; font-size:16px; }
  .btn.toggled{ outline:2px solid rgba(255,255,255,.08) }

  #site-favicon{ width:18px; height:18px; border-radius:4px; object-fit:cover; background:#1a1a1a; border:1px solid #2a2a2a; }

  .bar{
    flex:1 1 420px; max-width:100%; min-width:160px;
    display:flex; align-items:center; gap:8px;
    border:1px solid var(--stroke);
    background:linear-gradient(180deg, rgba(24,24,24,.92), rgba(16,16,16,.9));
    border-radius:999px; padding:8px 14px; margin:0;
    box-shadow:inset 0 1px 0 rgba(255,255,255,.03), 0 6px 18px rgba(0,0,0,.45);
  }

  /* Address input = dark theme */
  #sj-address{
    all:unset;
    color:var(--fg);
    -webkit-text-fill-color:var(--fg);
    caret-color:var(--fg);
    width:100%;
    font:14px/1.3 system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
  }
  #sj-address::placeholder{ color:var(--fg-dim); opacity:.85; }

  /* Suggestions */
  .sugg-wrap{ position:relative; flex:1 1 auto; min-width:160px; }
  #omnibox-suggestions{
    position:absolute; left:0; right:0; top:calc(100% + 6px);
    margin:0; padding:6px; list-style:none; z-index:10006;
    border:1px solid var(--stroke); border-radius:12px;
    background:linear-gradient(180deg, rgba(24,24,24,.98), rgba(16,16,16,.94));
    box-shadow:0 16px 40px rgba(0,0,0,.65);
    max-height:46vh; overflow:auto; display:none;
  }
  #omnibox-suggestions li{
    display:flex; align-items:center; gap:10px;
    padding:8px 10px; border-radius:10px; cursor:pointer;
    color:var(--fg); border:1px solid transparent;
  }
  #omnibox-suggestions li small{ color:var(--fg-dim) }
  #omnibox-suggestions li .fav{
    width:16px; height:16px; border-radius:4px; object-fit:cover;
    background:#1a1a1a; border:1px solid #2a2a2a; flex:0 0 16px;
  }
  #omnibox-suggestions li[aria-selected="true"]{
    border-color:var(--accent);
    background:linear-gradient(180deg, rgba(34,34,34,.96), rgba(22,22,22,.92));
  }

  /* Home */
  .home{ max-width:980px; margin:calc(var(--chrome-h) + 28px) auto 18vh; padding:0 18px; }
  html[data-collapsed="1"] .home{ margin:28px auto 18vh; }
  .hero{ padding:24px; border:1px solid var(--stroke); border-radius:var(--radius);
    background:linear-gradient(180deg, rgba(22,22,22,.78), rgba(14,14,14,.72)); box-shadow:var(--shadow); }
  .title{ margin:0 0 10px; font-size:28px; font-weight:800; letter-spacing:.2px; }
  .subtitle{ margin:0; color:var(--fg-dim); font-size:13px }
  .links{ margin-top:14px; display:flex; gap:12px; align-items:center; font-size:12px; color:var(--fg-dim) }
  .links a{ color:var(--fg); text-decoration:none; border-bottom:1px dashed transparent; padding-bottom:1px }

  #sj-error,#sj-error-code{ display:none }

  #sj-frame{
    position:fixed; left:0; right:0; top:var(--chrome-h);
    width:100vw; height:calc(100vh - var(--chrome-h));
    border:none; background:#0b0b0b;
    z-index:9998; display:none;
    transition:top .18s ease, height .18s ease;
  }
  html[data-collapsed="1"] #sj-frame{ top:0; height:100vh; }

  /* Collapse FAB */
  .fab{
    position:fixed; top:10px; right:12px; z-index:10005;
    border:1px solid var(--stroke);
    background:linear-gradient(180deg, rgba(26,26,26,.95), rgba(18,18,18,.9));
    color:var(--fg); border-radius:10px; width:34px; height:34px;
    display:none; align-items:center; justify-content:center;
    box-shadow:inset 0 1px 0 rgba(255,255,255,.03), 0 6px 18px rgba(0,0,0,.45);
    cursor:pointer;
  }
  html[data-collapsed="1"] #chrome-fab{ display:flex; }

  /* Settings pop (dark-only, more gradients) */
  .settings-pop{
    position:fixed; z-index:10004; display:none;
    border:1px solid var(--stroke); border-radius:12px; padding:12px;
    background:linear-gradient(180deg, rgba(24,24,24,.98), rgba(16,16,16,.94));
    box-shadow:var(--shadow); color:var(--fg); width:min(520px, calc(100vw - 20px));
  }
  .settings-pop h4{ margin:0 0 8px; font-size:14px; }
  .settings-group{ margin-bottom:10px; }
  .settings-row{ display:flex; gap:8px; flex-wrap:wrap; align-items:center; }
  .swatch{
    width:84px; height:40px; border-radius:10px; border:2px solid var(--stroke);
    cursor:pointer; position:relative; box-shadow:inset 0 1px 0 rgba(255,255,255,.03);
    transition:border-color .12s ease, box-shadow .12s ease, transform .12s ease;
  }
  .swatch:hover{ border-color: var(--accent); box-shadow:inset 0 1px 0 rgba(255,255,255,.05), 0 6px 18px rgba(0,0,0,.35); transform: translateY(-1px); }
  .swatch[data-active="1"]{ border-color: var(--accent); box-shadow:inset 0 1px 0 rgba(255,255,255,.06), 0 10px 26px rgba(0,0,0,.45); }
  .swatch[data-active="1"]::after{ content:"✓"; position:absolute; right:8px; bottom:6px; font-size:14px; opacity:.9; }
</style>

<!-- ======= RUNTIME ORDER (critical) ======= -->

<!-- 0) Set default WISP endpoint for HTTPS -->
<script>
  if (!("WISP_URL" in window) && location.protocol === "https:") {
    window.WISP_URL = "wss://" + location.host + "/wisp/";
  }
</script>

<!-- 1) BareMux client + worker (module) -->
<script type="module">
  const workerUrl = "https://cdn.jsdelivr.net/npm/@mercuryworkshop/bare-mux/dist/worker.js";
  const { BareMux } = await import("https://cdn.jsdelivr.net/npm/@mercuryworkshop/bare-mux/dist/client.min.js");

  const wisp = window.WISP_URL || (location.protocol === "https:" ?
    `wss://${location.host}/wisp/` : `ws://${location.host}/wisp/`);

  const mux = new BareMux({ worker: workerUrl });
  await mux.setClients([
    ["wisp",  { endpoint: wisp      }],
    ["epoxy", { endpoint: "/epoxy/" }]
  ]);

  window.__baremux = mux; // expose if downstream scripts look for it
</script>

<!-- 2) Scramjet runtime -->
<script src="/scram/scramjet.all.js"></script>

<!-- 3) Epoxy transport (served by your app at /epoxy/) -->
<script src="/epoxy/index.js" defer></script>

<!-- 4) Your app plumbing -->
<script src="register-sw.js" defer></script>
<script src="search.js" defer></script>
<script src="index.js" defer></script>
</head>

<body>
  <!-- Header -->
  <div class="chrome" role="navigation" aria-label="Browser controls">
    <div class="row tabs">
      <div class="tabs-wrap" id="tabs" role="tablist" aria-label="Tabs">
        <button id="tab-add" class="tab-add" title="New tab"></button>
      </div>
    </div>
    <div class="row">
      <div class="omnibox">
        <button id="reload"  class="btn icon" title="Reload">↻</button>
        <button id="inspect" class="btn icon" title="Inspect (toggle)">&lt;/&gt;</button>
        <button id="settings" class="btn icon" title="Settings">⚙️</button>
        <button id="chrome-toggle" class="btn icon" title="Collapse" aria-label="Collapse">–</button>
        <img id="site-favicon" alt="" src="" referrerpolicy="no-referrer" crossorigin="anonymous" />
        <div class="sugg-wrap">
          <form id="sj-form" class="bar" autocomplete="off" role="search">
            <input id="sj-search-engine" type="hidden" value="https://www.google.com/search?q=%s" />
            <input id="sj-address" type="text" placeholder="URL or search…" spellcheck="false" inputmode="url" />
          </form>
          <ul id="omnibox-suggestions" role="listbox" aria-label="Suggestions"></ul>
        </div>
      </div>
    </div>
  </div>

  <!-- Expand FAB (when collapsed) -->
  <button id="chrome-fab" class="btn icon fab" title="Expand" aria-label="Expand">+</button>

  <!-- Home -->
  <main class="home" id="home">
    <div class="hero">
      <h1 class="title">PROJECT TRINITY</h1>
      <p class="subtitle">1.1.4</p>
      <div class="links">
        <a href="credits.html">Credits</a><span>·</span>
        <a href="https://github.com/MercuryWorkshop" target="_blank" rel="noopener">Github</a><span>·</span>
        <a href="https://www.trinity.gt.tc" target="_blank" rel="noopener">TRINITY</a><span>·</span>
        <span>PT © 2025</span>
      </div>
    </div>
  </main>

  <!-- Scramjet surface -->
  <iframe id="sj-frame"></iframe>

  <!-- Hooks -->
  <p id="sj-error"></p>
  <pre id="sj-error-code"></pre>

  <!-- Settings: dark-only gradients (12) -->
  <div id="settings-pop" class="settings-pop" role="dialog" aria-modal="false" aria-labelledby="settings-title">
    <div class="settings-group">
      <h4 id="settings-title">Gradient</h4>
      <div class="settings-row">
        <div class="swatch" data-value="graphite" style="background:linear-gradient(180deg,#0a0a0a,#0d0d0d 55%,#121212)"></div>
        <div class="swatch" data-value="abyss"    style="background:linear-gradient(180deg,#0a0f1a,#0b1320 55%,#0c1726)"></div>
        <div class="swatch" data-value="violet"   style="background:linear-gradient(180deg,#120a1a,#1a0f2b 55%,#23143a)"></div>
        <div class="swatch" data-value="teal"     style="background:linear-gradient(180deg,#071a1a,#0a2222 55%,#0d2a2a)"></div>
        <div class="swatch" data-value="slate"    style="background:linear-gradient(180deg,#0c0d10,#101218 55%,#141820)"></div>
        <div class="swatch" data-value="obsidian" style="background:linear-gradient(180deg,#0b0c0e,#101318 55%,#171b22)"></div>
        <div class="swatch" data-value="onyx"     style="background:linear-gradient(180deg,#0a0a0b,#0e0f11 55%,#141518)"></div>
        <div class="swatch" data-value="nebula"   style="background:linear-gradient(180deg,#0b0b14,#121430 55%,#1a1d47)"></div>
        <div class="swatch" data-value="cyber"    style="background:linear-gradient(180deg,#0a1014,#0b1620 55%,#0d1e2b)"></div>
        <div class="swatch" data-value="oil"      style="background:linear-gradient(180deg,#0a0a0a,#13100d 55%,#1b1612)"></div>
        <div class="swatch" data-value="night"    style="background:linear-gradient(180deg,#080a12,#0b0f1a 55%,#0f1524)"></div>
        <div class="swatch" data-value="carbon"   style="background:linear-gradient(180deg,#0a0a0b,#111213 55%,#191b1d)"></div>
      </div>
    </div>
  </div>
</body>
</html>
